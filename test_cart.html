<!DOCTYPE html>
<html>
<head>
    <title>æ¸¬è©¦è³¼ç‰©è»Š</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f8ff; }
        .container { max-width: 800px; margin: 0 auto; }
        .product { 
            background: white; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 10px; 
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .product:hover { border-color: #1976d2; }
        .cart { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-top: 20px; 
        }
        .cart-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 1px solid #eee; 
        }
        button { 
            background: #1976d2; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        .total { font-size: 24px; font-weight: bold; color: #1976d2; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›’ æ¸¬è©¦è³¼ç‰©è»Š</h1>
        
        <h2>å•†å“åˆ—è¡¨ï¼š</h2>
        <div id="products"></div>
        
        <div class="cart">
            <h2>è³¼ç‰©è»Š <span id="cartCount">0</span></h2>
            <div id="cartItems"></div>
            <div class="total" id="totalAmount">ç¸½è¨ˆ: $0</div>
            <button onclick="checkout()">çµå¸³æ¸¬è©¦</button>
        </div>
    </div>

    <script>
        // å•†å“è³‡æ–™
        const products = [
            { id: 1, name: 'é–åŒ™æ‰£ç›²ç›’', price: 35 },
            { id: 2, name: '[COMBO] é–åŒ™æ‰£ç›²ç›’ * 5', price: 150 },
            { id: 3, name: 'æœˆæ›†', price: 50 }
        ];
        
        let cart = [];
        
        // é¡¯ç¤ºå•†å“
        function renderProducts() {
            const div = document.getElementById('products');
            div.innerHTML = '';
            
            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product';
                productDiv.onclick = () => addToCart(product);
                productDiv.innerHTML = `
                    <strong>${product.name}</strong> - $${product.price}
                `;
                div.appendChild(productDiv);
            });
        }
        
        // åŠ å…¥è³¼ç‰©è»Š
        function addToCart(product) {
            const existing = cart.find(item => item.id === product.id);
            
            if (existing) {
                existing.quantity++;
                existing.subtotal = existing.quantity * existing.price;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    subtotal: product.price
                });
            }
            
            renderCart();
        }
        
        // æ›´æ–°æ•¸é‡
        function updateQuantity(id, change) {
            const index = cart.findIndex(item => item.id === id);
            if (index !== -1) {
                cart[index].quantity += change;
                if (cart[index].quantity <= 0) {
                    cart.splice(index, 1);
                } else {
                    cart[index].subtotal = cart[index].quantity * cart[index].price;
                }
                renderCart();
            }
        }
        
        // é¡¯ç¤ºè³¼ç‰©è»Š
        function renderCart() {
            const cartDiv = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const totalSpan = document.getElementById('totalAmount');
            
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p>è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>';
                totalSpan.textContent = 'ç¸½è¨ˆ: $0';
                return;
            }
            
            let html = '';
            let total = 0;
            
            cart.forEach(item => {
                total += item.subtotal;
                html += `
                    <div class="cart-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            $${item.price} x ${item.quantity}
                        </div>
                        <div>
                            $${item.subtotal}
                            <button onclick="updateQuantity(${item.id}, -1)">-</button>
                            <button onclick="updateQuantity(${item.id}, 1)">+</button>
                        </div>
                    </div>
                `;
            });
            
            cartDiv.innerHTML = html;
            totalSpan.textContent = `ç¸½è¨ˆ: $${total}`;
        }
        
        // çµå¸³æ¸¬è©¦
        async function checkout() {
            if (cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + item.subtotal, 0);
            
            const orderData = {
                items: cart.map(item => ({
                    product_id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    subtotal: item.subtotal
                })),
                total: total
            };
            
            console.log('é€å‡ºè¨‚å–®:', orderData);
            
            try {
                const response = await fetch('php/create_order.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData),
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                console.log('å›æ‡‰:', data);
                
                if (data.success) {
                    alert(`è¨‚å–®æˆåŠŸï¼ç·¨è™Ÿï¼š${data.data.order_number}`);
                    cart = [];
                    renderCart();
                } else {
                    alert(`å¤±æ•—ï¼š${data.message}`);
                }
            } catch (error) {
                alert('éŒ¯èª¤ï¼š' + error.message);
            }
        }
        
        // åˆå§‹åŒ–
        renderProducts();
    </script>
</body>
</html>